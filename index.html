<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Общий чат</title>
  <style>
    body { font-family:sans-serif; padding:20px; background:#fafafa; }
    #commonChat { border:1px solid #ccc; height:400px; overflow-y:auto; padding:10px; margin-bottom:10px; }
    input, button { padding:5px; font-size:16px; width:100%; box-sizing:border-box; margin-top:5px; }
    .message { margin-bottom:5px; padding:3px 5px; border-radius:4px; }
    .my-message { background:#e7f3ff; }
  </style>
</head>
<body>
<h2>Общий чат</h2>
<div id="commonChat"></div>
<input id="name" placeholder="Ваше имя" />
<input id="message" placeholder="Сообщение" />
<button onclick="sendMessage()">Отправить</button>
<br><br>
<!-- Кнопка открывает личные сообщения в новой вкладке -->
<button onclick="window.open('private.html','_blank')">Личные сообщения</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA5meIzTc-zrp3mV2Xg7QQ8Vf_brx58T-g",
  authDomain: "reos21-f0203.firebaseapp.com",
  projectId: "reos21-f0203",
  storageBucket: "reos21-f0203.firebasestorage.app",
  messagingSenderId: "221186151213",
  appId: "1:221186151213:web:7e9f4a842298070d8ff9a4",
  measurementId: "G-61G91NP8DR"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const commonChatDiv = document.getElementById('commonChat');

function sendMessage(){
  const name = document.getElementById('name').value.trim() || 'Гость';
  const msg = document.getElementById('message').value.trim();
  if(!msg) return;
  db.collection('commonMessages').add({
    name, 
    message: msg,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById('message').value='';
}

db.collection('commonMessages').orderBy('timestamp').onSnapshot(snap=>{
  commonChatDiv.innerHTML='';
  snap.forEach(doc=>{
    const msg = doc.data();
    commonChatDiv.innerHTML += `<div class="message"><b>${msg.name}:</b> ${msg.message}</div>`;
  });
  commonChatDiv.scrollTop = commonChatDiv.scrollHeight;
});
</script>
</body>
</html>
